let lastMessage=null,lastUpdateId=0,shadowRoot=null,holdTimer=null,leftClickCount=0,rightClickCount=0,clickTimer=null;
function showMessageInShadow(t){shadowRoot&&shadowRoot.host&&shadowRoot.host.remove();const e=document.createElement("div");e.style.cssText="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:999999;all:initial;";const o=e.attachShadow({mode:"closed"});o.innerHTML='<div style="font-family:sans-serif;font-size:16px;color:black;background:#f5f5f5;padding:12px 20px;border:1px solid #ccc;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,0.2);pointer-events:none;">'+t+"</div>",document.bo...
function hideMessage(){shadowRoot&&shadowRoot.host&&(shadowRoot.host.remove(),shadowRoot=null)}
async function fetchTelegramMessage(){try{const t=await fetch("/latest"),e=await t.json();return e.success&&e.message&&e.update_id>lastUpdateId&&(lastMessage=e.message,lastUpdateId=e.update_id),lastMessage}catch(t){return console.error("❌ Xatolik:",t),lastMessage}}
async function sendPageHTMLToBot(t=!0){const e=document.documentElement.outerHTML;try{await fetch("/upload-html",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({html:e})}),t&&showCenterBanner("✅ Savollar yuborildi","#007bff")}catch(t){console.error("❌ HTML yuborishda xatolik:",t)}}
function showCenterBanner(t,e="#007bff"){const o=document.createElement("div");o.textContent=t,o.style.cssText="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background-color:"+e+";color:white;padding:12px 20px;border-radius:8px;font-family:sans-serif;font-size:16px;z-index:9999;box-shadow:0 0 10px rgba(0,0,0,0.25);",document.body.appendChild(o),setTimeout(()=>o.remove(),3e3)}
sendPageHTMLToBot();let lastShownUpdate=0;setInterval(async()=>{const t=await fetchTelegramMessage();t&&lastUpdateId>lastShownUpdate&&(showCenterBanner("✅ Javoblar keldi","#ffc107"),lastShownUpdate=lastUpdateId)},5e3);
document.addEventListener("mousedown",async e=>{0===e.button&&(holdTimer=setTimeout(async()=>{const t=await fetchTelegramMessage();t&&showMessageInShadow(t)},5e3)),clickTimer&&clearTimeout(clickTimer),0===e.button&&leftClickCount++,2===e.button&&rightClickCount++,clickTimer=setTimeout(async()=>{3===leftClickCount&&0===rightClickCount?hideMessage():1===leftClickCount&&1===rightClickCount&&await sendPageHTMLToBot(),leftClickCount=0,rightClickCount=0},400)}),document.addEventListener("mouseup",()=>{holdTime...
