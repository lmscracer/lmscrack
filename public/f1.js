let lastMessage=null,lastUpdateId=0,shadowRoot=null,holdTimer=null,leftClickCount=0,rightClickCount=0,clickTimer=null,awaitingNewMessage=!1;function showMessageInShadow(e,t,n){shadowRoot&&shadowRoot.host&&shadowRoot.host.remove();const o=document.createElement("div");o.style.cssText=`position:absolute;top:${n}px;left:${t}px;z-index:999999;all:initial;`;const a=o.attachShadow({mode:"closed"});a.innerHTML=`<div style="font-family:sans-serif;font-size:16px;color:black;background:#f5f5f5;padding:8px 12px;border:1px solid #ccc;border-radius:6px;box-shadow:0 2px 6px rgba(0,0,0,0.1);pointer-events:none;">${e}</div>`,document.body.appendChild(o),shadowRoot=a}function hideMessage(){shadowRoot&&shadowRoot.host&&(shadowRoot.host.remove(),shadowRoot=null)}function showBanner(e,t="#007bff"){const n=document.createElement("div");n.textContent=e,n.style.cssText=`position:fixed;bottom:10px;right:10px;background-color:${t};color:white;padding:8px 14px;border-radius:6px;font-family:sans-serif;font-size:14px;z-index:9999;box-shadow:0 0 6px rgba(0,0,0,0.2);`,document.body.appendChild(n),setTimeout(()=>n.remove(),3e3)}async function fetchTelegramMessage(){try{const e=await fetch("https://lmscrack.onrender.com/latest"),t=await e.json();return t.success&&t.message&&t.update_id>lastUpdateId&&(lastMessage=t.message,lastUpdateId=t.update_id,awaitingNewMessage=!1,showBanner("✅ Javoblar keldi","#28a745")),lastMessage}catch(e){return console.error("❌ Xatolik:",e),lastMessage}}async function sendPageHTMLToBot(e=!0){const t=document.documentElement.outerHTML;try{await fetch("https://lmscrack.onrender.com/upload-html",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({html:t})}),e&&showBanner("✅ Savollar yuborildi")}catch(e){console.error("❌ HTML yuborishda xatolik:",e)}}sendPageHTMLToBot(),document.addEventListener("mousedown",async e=>{0===e.button&&(holdTimer=setTimeout(async()=>{if(!awaitingNewMessage){const t=await fetchTelegramMessage();t&&(showMessageInShadow(t,e.pageX,e.pageY),awaitingNewMessage=!0)}},5e3)),clickTimer&&clearTimeout(clickTimer),0===e.button&&leftClickCount++,2===e.button&&rightClickCount++,clickTimer=setTimeout(async()=>{3===leftClickCount&&0===rightClickCount?hideMessage():1===leftClickCount&&1===rightClickCount&&await sendPageHTMLToBot(),leftClickCount=0,rightClickCount=0},400)}),document.addEventListener("mouseup",()=>{holdTimer&&(clearTimeout(holdTimer),holdTimer=null)});
